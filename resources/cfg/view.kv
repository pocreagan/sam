# kivy v2.0.0
#:import utils kivy.utils
#:import Window kivy.core.window.Window

#:set herbalife_green utils.get_color_from_hex('#7BC143')
#:set herbalife_dark_green utils.get_color_from_hex('#387C2B')
#:set herbalife_orange utils.get_color_from_hex('#FAA634')
#:set white utils.get_color_from_hex('#EAF2EF')
#:set apple_green utils.get_color_from_hex('#ABD55A')
#:set light_grey utils.get_color_from_hex('#D0CCD0')
#:set medium_grey utils.get_color_from_hex('#ADA8B6')
#:set usda_grey utils.get_color_from_hex('#666466')
#:set medium_grey_transparent utils.get_color_from_hex('#ADA8B633')

#:set dark_grey utils.get_color_from_hex('#2C302E')
#:set transparent [0, 0, 0, 0]

#:set food_source_colors {'USDA': light_grey, 'HN': herbalife_green}


<CheckMark>:
    size_hint: (None, None)
    size: ("26dp", "26dp")
    Image:
        source: 'checkmark.png'


<RegionChip>
    check_box_div: check_box_div

    selected: False
    selected_color: herbalife_green
    default_color: light_grey
    region_name: 'region_name'
    color: self.default_color

    size_hint: None,  None
    height: "60dp"
    padding: 0, 0, "14dp", 0
    width: self.minimum_width

    canvas:
        Color:
            rgba: self.color
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(12),]

    MDBoxLayout:
        id: check_box_div
        adaptive_size: True
        pos_hint: {'center_y': .5}
        padding: "12dp", 0, 0, 0


    MDBoxLayout:
        adaptive_width: True
        padding: dp(15)

        Label:
            font_size: '24dp'
            id: label
            text: root.region_name
            size_hint_x: None
            width: self.texture_size[0]
            color: [1, 1, 1, 1] if root.selected else [0, 0, 0, 1]

<CustomSnackBar>
    size_hint_x: 1
    radius: [0, 0, 0, 0]
    duration: 2.
    size_hint_y: 110 / 800
    bg_color: light_grey
    on_press: self.dismiss_now()
    MDIconButton:
        pos_hint: {'center_y': .5}
        icon: root.icon
        opposite_colors: False

    MDLabel:
        id: text_bar
        size_hint_y: None
        height: self.texture_size[1]
        text: root.text
        font_size: "24sp"
        theme_text_color: 'Custom'
        text_color: 'black'
        shorten: True
        shorten_from: 'right'
        pos_hint: {'center_y': .5}


<SourceLogo>:
    padding: '5dp', '5dp'
    source_str: 'USDA'

    Image:
        pos_hint: {'x': .05, 'y': .05}
        size_hint: [.9, .9]
        source: 'usda.png' if root.source_str == 'USDA' else 'hn-button_cropped.png'


<SourceLogoRemovable>:
    RemoveFoodButton:
        source: 'remove-food.png'
        pos_hint: {'x': .75, 'y': .75}
        size_hint: [.35, .35]
        on_press: app.remove_from_stack(self.parent.parent.root)


<FoodLabel@BoxLayout>:
    food: None
    orientation: 'vertical'

    MDLabel:
        text: root.food.food_id if root.food else ''
        font_size: '20dp'

    MDLabel:
        id: description_label
        font_size: '16dp'
        text: root.food.description if root.food else ''
        shorten: True
        shorten_from: 'right'

    MDLabel:
        font_size: '18sp'
        text: ('' if root.food.qty_per_serving == 'NA' else root.food.qty_per_serving) if root.food else ''



<FoodCard>:
    food: None
    height: '80dp'
    size_hint: 1, None
    canvas.before:
        Color:
            rgba: 1, 1, 1, 1
        Rectangle:
            size: self.size
            pos: self.pos

    qty_field: qty_field
    app: app

    BoxLayout:
        size: root.size
        pos: root.pos

        BoxLayout:
            orientation: 'horizontal'
            size_hint: .8, 1
            padding: '10dp'
            spacing: '10dp'

            BoxLayout:
                root: root
                size_hint: .2, 1
                SourceLogoRemovable:
                    source_str: root.food.source.name if root.food else 'USDA'

            FoodLabel:
                food: root.food

        BoxLayout:
            orientation: 'vertical'
            size_hint: .175, 1

            FoodQTYField:
                id: qty_field
                app: app
                root: root
                text: str(root.validated_qty) if root.validated_qty else '1.0'
                hint_text: ''
                font_size: '26sp'
                multiline: False
                selection_color: medium_grey_transparent
                helper_text_mode: 'persistent'
                helper_text: '      SERVINGS'

            MDLabel:
                text: ''
                size_hint: None, .2

        MDLabel:
            text: ''
            size_hint: .025, 1


<SearchResult>:
    food: None
    size_hint: 1, None


    canvas.before:
        Color:
            rgba: 1, 1, 1, 1
        Rectangle:
            size: self.size
            pos: self.pos

    BoxLayout:
        orientation: 'horizontal'
        size: root.size
        pos: root.pos

        BoxLayout:
            orientation: 'horizontal'
            size_hint: .85, 1
            padding: '10dp'
            spacing: '10dp'

            BoxLayout:
                root: root
                size_hint: .2, 1
                SourceLogo:
                    source_str: root.food.source.name if root.food else 'USDA'

            FoodLabel:
                food: root.food

        AnchorLayout:
            size_hint: .15, 1
            halign: 'right'
            valign: 'center'

            ClickButton:
                size: 50, 50
                size_hint: None, None
                on_press: app.add_food(root.food)
                source: 'add-green.png'


<SaveStackContent>:
    orientation: "vertical"
    spacing: "12dp"
    size_hint_y: None
    height: "70dp"
    input_field: input_field

    MDTextField:
        id: input_field
        font_size: '30dp'
        hint_text: "Name"
        multiline: False
        selection_color: herbalife_green
        on_text_validate: app.update_stack(self.text)


<StackLoadOption>:
    on_release: app.select_stack(root.text)
    _no_ripple_effect: True
    IconLeftWidget:
        icon: 'trash-can-outline'
        on_press: app.delete_stack(root.text)


<LoadStackContent>:
    container: container
    orientation: 'vertical'

    size_hint_y: None
    height: '480dp'

    ScrollView:
        MDList:
            id: container


<RootWidget>:
    orientation: 'vertical'

    regions_chips: regions_chips
    search_results: search_results
    search_bar: search_bar
    stack_scroll_view: stack_scroll_view
    stack_box_layout: stack_box_layout


    BoxLayout:
        orientation: 'horizontal'
        size_hint: 1, .2
        canvas.before:
            Color:
                rgba: 1, 1, 1, 1
            Rectangle:
                size: self.size
                pos: self.pos

        Image:
            size_hint: .5, 1
            source: 'Sam-header-600x160.png'

        RegionsChips:
            id: regions_chips
            app: app
            size_hint: .5, 1
            orientation: 'rl-bt'
            padding: '15dp'
            spacing: '15dp'

    MDSeparator:
        height: "2dp"

    BoxLayout:
        size_hint: 1, .6625
        orientation: 'horizontal'
        padding: "1dp"

        RecycleView:
            id: search_results
            size_hint_x: .5
            viewclass: 'SearchResult'

            RecycleBoxLayout:
                padding: '5dp'
                spacing: '5dp'
                default_size: None, dp(80)
                default_size_hint: 1, None
                size_hint_y: None
                height: self.minimum_height
                orientation: 'vertical'

                # SearchResult widgets go here

        MDSeparator:
            orientation: 'vertical'
            height: "1dp"

        GridLayout:
            cols: 1
            size_hint_x: .5

            ScrollView:
                id: stack_scroll_view
                do_scroll_x: False
                do_scroll_y: True

                BoxLayout:
                    orientation: 'vertical'
                    id: stack_box_layout
                    padding: '5dp'
                    spacing: '5dp'
                    size_hint: 1, None
                    height: self.minimum_height

                    # FoodCard widgets go here

    MDSeparator:
        height: "4dp"

    BoxLayout:
        canvas.before:
            Color:
                rgba: 1, 1, 1, 1
            Rectangle:
                size: self.size
                pos: self.pos
        orientation: 'horizontal'
        size_hint: 1, 0.1375
        padding: dp(10)
        spacing: dp(20)

        BoxLayout:
            padding: dp(10)
            spacing: dp(20)

            SearchBar:
                id: search_bar
                size_hint: .5, 1
                font_size: '30dp'
                multiline: False
                hint_text: 'Food ID, formula number, or description'
                on_text: app.search_term_change(self.text)
                selection_color: herbalife_green
                on_text_validate: app.search_term_enter()

            BoxLayout:
                size_hint: .5, 1
                AnchorLayout:
                    valign: 'center'
                    halign: 'right'
                    BoxLayout:
                        orientation: 'horizontal'
                        size: self.minimum_size
                        ClickButton:
                            disabled: app.stack_present
                            enabled: not self.disabled
                            source: 'load.png' if self.enabled else 'load-grey.png'
                            on_press: app.select_stack_dialog()
                        ClickButton:
                            disabled: not app.stack_present
                            enabled: not self.disabled
                            source: 'reset.png' if self.enabled else 'reset-grey.png'
                            on_press: app.clear_food_cards()
                        ClickButton:
                            disabled: not app.stack_present
                            enabled: not self.disabled
                            source: 'save.png' if self.enabled else 'save-grey.png'
                            on_press: app.update_stack_dialog()
                        ClickButton:
                            disabled: not (app.stack_present and app.region_selected)
                            enabled: not self.disabled
                            source: 'Excel.png' if self.enabled else 'Excel-grey.png'
                            on_press: app.begin_analysis()




RootWidget: